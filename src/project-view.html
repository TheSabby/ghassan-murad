<link rel="import"
      href="../bower_components/polymer/polymer-element.html">
<link rel="import"
      href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import"
      href="../bower_components/app-route/app-route.html">
<link rel="import"
      href="../bower_components/google-youtube/google-youtube.html">

<link rel="import"
      href="project-image.html">

<script src="../projects/projects.js"></script>

<dom-module id="project-view">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
        background-color: #000;
      }

      .container {
        margin: auto;
        min-height: calc(100vh - 64px);
        position: relative;
      }

      .project-info {
        padding: 25px 16px;
        text-align: center;
        min-height: 100px;
        background-color: #000;
        color: #fff;
        box-sizing: border-box;
      }

      .project-title {
        font-family: 'Cairo', 'Roboto', 'Noto', sans-serif;
        text-transform: uppercase;
        font-weight: bold;
        font-size: 2.1rem;
      }

      .project-desc {
        font-family: 'Roboto', 'Noto', sans-serif;
        font-size: 1rem;
      }

      .youtube {
        margin: auto;
      }

      .media {
        position: relative;
        display: flex;
        flex-direction: column;
        background-color: #000;
        border: solid 5px #000;
      }

      @media only screen and (min-width: 1024px) {
        .media {
          position: relative;
          display: grid;
          grid-gap: 5px;
          grid-template-columns: 1fr 1fr 1fr 1fr;
        }
      }
    </style>

    <app-route route="{{route}}"
               pattern="/:projectId"
               data="{{routeData}}"></app-route>

    <div class="container vertical layout">
      <div class="project-info vertical layout">
        <div class="project-title">{{title}}</div>
        <div class="project-desc">{{desc}}</div>
      </div>
      <div id="media"
           class="media"></div>
      <div class="horizontal layout center-center">
        <google-youtube id="youtube"
                        class="youtube"
                        video-id="[[videoId]]"
                        rel="0"
                        width="[[youtubeWidthText]]"
                        height="[[youtubeHeightText]]"
                        autoplay="0"></google-youtube>
      </div>
    </div>
  </template>

  <script>
    class ProjectView extends Polymer.Element {
      static get is() { return 'project-view'; }

      static get properties() {
        return {
          inView: {
            type: Boolean,
            observer: 'projectChanged'
          },
          route: Object,
          routeData: Object,
          projectId: {
            type: String,
            value: '0',
            observer: 'projectChanged'
          },
          project: Object,
          type: String,
          title: String,
          desc: String,
          storagePath: String,
          videoId: String,
          youtubeWidth: {
            type: String,
            value: () => {
              if (+document.documentElement.clientWidth >= 1024) {
                return 1024;
              } else {
                var width = +document.documentElement.clientWidth;
                var height = Math.ceil((width / 16) * 9);
                if (height > document.documentElement.clientHeight) {
                  height = +document.documentElement.clientHeight;
                  width = Math.ceil((height / 9) * 16);
                }
                return width;
              }
            },
            observer: 'youtubeWidthSet'
          },
          youtubeHeight: {
            type: Number,
            value: 576
          },
          youtubeWidthText: String,
          youtubeHeightText: String
        };
      }

      static get observers() {
        return [
          '_routeProjectChanged(routeData.projectId)',
        ];
      }

      _routeProjectChanged(projectId) {
        this.projectId = projectId || '0';
      }

      projectChanged() {
        if (this.inView) {
          this.renderProject();
        }
      }

      renderProject() {
        this.project = projects.find(project => project.id == this.projectId);
        this.$.media.innerHTML = '';
        this.type = this.project.type;
        this.title = this.project.title;
        this.desc = this.project.description;
        this.storagePath = this.project.storage_path;

        if (this.type == 'video') {
          this.$.youtube.style.display = 'block';
          this.$.media.style.display = 'none';
          this.videoId = this.project.video_url;
        } else {
          this.$.youtube.style.display = 'none';
          this.project.images.forEach(image => {
            var project_image = new ProjectImage(this.storagePath, image, this.projectId);
            this.$.media.appendChild(project_image);
          });
        }
      }

      youtubeWidthSet() {
        this.youtubeWidthText = this.youtubeWidth + 'px';
        this.youtubeHeight = Math.ceil((this.youtubeWidth / 16) * 9);
        this.youtubeHeightText = this.youtubeHeight + 'px';
        this.$.youtube.style.margin = 0;
        this.$.youtube.style.padding = 0;
      }
    }

    window.customElements.define(ProjectView.is, ProjectView);
  </script>
</dom-module>